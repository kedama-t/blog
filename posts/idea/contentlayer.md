---
title: contentlayer
date: 2023-11-30
emoji: ğŸ¤”
---

# Contentlayer ã®è‰²ã€…

## åº

- [Next.js](https://nextjs.org/)ã¨[Contentlayer](https://contentlayer.dev/)ã‚’ä½¿ã£ã¦ã€Markdown ãƒ–ãƒ­ã‚°ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚
- Contentlayer ã§ Markdown ã‚’ä½¿ã†ã«ã‚ãŸã£ã¦ã€ ToC ã‚’ç”Ÿæˆã—ãŸã‹ã£ãŸã®ã§ã™ãŒã€æ—¢å­˜ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯ã‚¤ãƒã‚¤ãƒã ã£ãŸã®ã§ã€`computedFields`ã«ã‚´ãƒªæŠ¼ã—ã§å®Ÿè£…ã—ãŸäº‹ä¾‹ã§ã™ã€‚
- ãã®ä»–ã€ã„ã‚ã„ã‚ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®äº‹ä¾‹ã‚‚å‚™å¿˜éŒ²çš„ã«è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚

### Contentlayer

- Markdown ã¾ãŸã¯[MDX](https://mdxjs.com/) å½¢å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ã€å‹ãŒä»˜ã„ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã¨ã—ã¦æ‰±ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
  - [Notion]ãŒè©¦é¨“çš„ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãŸã‚Šã€[Contentful]ã»ã‹ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ CMS ã®ã‚µãƒãƒ¼ãƒˆã‚’è¨ˆç”»ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

#### ä¾‹ãˆã°

ã“ã‚ŒãŒ

```markdown
---
title: ä¾‹ãˆã°
date: 2023-12-01
emoji: ğŸ“
description: ç¬¬ä¸€ã¨ã„ã†ã¨ã€ã‚ãªãŸã®èƒ¸ã«ã¯ã¾ãŸå¤±ã‚ã‚Œã¦ã—ã¾ã†ã®ã ãã†ã§ã™ã€‚
tags: 
  - Lorem Ipsum
  - Next.js
  - Tailwind CSS
  - Contentlayer
---

## ã‚‚ã£ã¨ã‚‚ãã®æ™‚ã®ç§ã®åˆ¤æ–­ã«ç¸‹ã‚Šä»˜ã“ã†ã¨ã—ãŸã®ã§ã™ã€‚

ãã‚Œã¯å‰å¾Œã§ä¸åº¦ä¸‰ã€å››æ—¥ç¶šã„ã¦å‡ºãŸã€‚å¥¥ã•ã‚“ã®åã¯é™ã¨ã„ã£ãŸã®ã§ã™ã€‚ç§ã¯ãã®æ™‚è‡ªåˆ†ã®è¨€è‘‰ä½¿ã„ã®è§’å¼µã£ãŸã¨ã“ã‚ã«æ°—ãŒä»˜ãã¯ãšãŒãªã‹ã£ãŸã€‚

- å²©ã®ä¸Šã‹ã‚‰è¦‹ä¸‹ã™æ°´ã¯ã€ã¾ãŸæ¥µã‚ã¦ç°¡å˜ã§ã—ãŸã€‚
- ã—ã‹ã‚‚ç´°å›ã¯å¤«ãŒå¯ã¦ã„ã‚‹çˆ¶ã‚’è¦‹ãŸã€‚
- ãã‚ŒãŒè§£ã‚‹ãã‚‰ã„ãªã‚‰ç§ã ã£ã¦åŒã˜äº‹ã§ã‚ã£ãŸã€‚

## ã—ã‹ã—â€¦â€¦ç§ã¯ã“ã®è³ªå•ã®è£ã«ãã£ã¨ç½®ã‹ã‚ŒãŸã€‚

ã‚‚ã†ä½•ã«ã‚‚ã™ã‚‹äº‹ã¯ã‚ã‚Šã¾ã—ãŸã€‚ç§ã¯ã“ã®é–“ä¸­èã„ãŸã®ã§ã™ã€‚ãã®ãã‚‰ã„ã ã‹ã‚‰çˆ¶ã®å±é™ºãŒçœ¼ã®å‰ã«æ¶™ãã‚“ã ã€‚

1. äººé–“ã‚’æ„›ã—å¾—ã‚‹äººã€æ„›ã›ãšã«ã¯ã„ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚
2. ç§ã¯ä½•ã¨ã‚‚æ€ã„ã¾ã›ã‚“ã§ã—ãŸã€‚
3. ã™ã‚‹ã¨ï¼«ã¯è¶³ãŒå‘ã‹ãªããªã‚Šã¾ã™ã€‚
```

ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚

```json
{
  "title": "ä¾‹ãˆã°",
  "description": "ç¬¬ä¸€ã¨ã„ã†ã¨ã€ã‚ãªãŸã®èƒ¸ã«ã¯ã¾ãŸå¤±ã‚ã‚Œã¦ã—ã¾ã†ã®ã ãã†ã§ã™ã€‚",
  "date": "2023-12-01T00:00:00.000Z",
  "emoji": "ğŸ“",
  "tags": [
    "Lorem Ipsum",
    "Next.js",
    "Tailwind CSS",
    "Contentlayer\r"
  ],
  "body": {
    "raw": "\r\n## ã‚‚ã£ã¨ã‚‚ãã®æ™‚ã®ç§ã®åˆ¤æ–­ã«ç¸‹ã‚Šä»˜ã“ã†ã¨ã—ãŸã®ã§ã™ã€‚\r\n\r\nãã‚Œã¯å‰å¾Œã§ä¸åº¦ä¸‰ã€å››æ—¥ç¶šã„ã¦å‡ºãŸã€‚å¥¥ã•ã‚“ã®åã¯é™ã¨ã„ã£ãŸã®ã§ã™ã€‚ç§ã¯ãã®æ™‚è‡ªåˆ†ã®è¨€è‘‰ä½¿ã„ã®è§’å¼µã£ãŸã¨ã“ã‚ã«æ°—ãŒä»˜ãã¯ãšãŒãªã‹ã£ãŸã€‚\r\n\r\n- å²©ã®ä¸Šã‹ã‚‰è¦‹ä¸‹ã™æ°´ã¯ã€ã¾ãŸæ¥µã‚ã¦ç°¡å˜ã§ã—ãŸã€‚\r\n- ã—ã‹ã‚‚ç´°å›ã¯å¤«ãŒå¯ã¦ã„ã‚‹çˆ¶ã‚’è¦‹ãŸã€‚\r\n- ãã‚ŒãŒè§£ã‚‹ãã‚‰ã„ãªã‚‰ç§ã ã£ã¦åŒã˜äº‹ã§ã‚ã£ãŸã€‚\r\n\r\n## ã—ã‹ã—â€¦â€¦ç§ã¯ã“ã®è³ªå•ã®è£ã«ãã£ã¨ç½®ã‹ã‚ŒãŸã€‚\r\n\r\nã‚‚ã†ä½•ã«ã‚‚ã™ã‚‹äº‹ã¯ã‚ã‚Šã¾ã—ãŸã€‚ç§ã¯ã“ã®é–“ä¸­èã„ãŸã®ã§ã™ã€‚ãã®ãã‚‰ã„ã ã‹ã‚‰çˆ¶ã®å±é™ºãŒçœ¼ã®å‰ã«æ¶™ãã‚“ã ã€‚\r\n\r\n1. äººé–“ã‚’æ„›ã—å¾—ã‚‹äººã€æ„›ã›ãšã«ã¯ã„ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\r\n2. ç§ã¯ä½•ã¨ã‚‚æ€ã„ã¾ã›ã‚“ã§ã—ãŸã€‚\r\n3. ã™ã‚‹ã¨ï¼«ã¯è¶³ãŒå‘ã‹ãªããªã‚Šã¾ã™ã€‚\r\n",
    "html": "<h2 id=\"ã‚‚ã£ã¨ã‚‚ãã®æ™‚ã®ç§ã®åˆ¤æ–­ã«ç¸‹ã‚Šä»˜ã“ã†ã¨ã—ãŸã®ã§ã™\">ã‚‚ã£ã¨ã‚‚ãã®æ™‚ã®ç§ã®åˆ¤æ–­ã«ç¸‹ã‚Šä»˜ã“ã†ã¨ã—ãŸã®ã§ã™ã€‚<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ã‚‚ã£ã¨ã‚‚ãã®æ™‚ã®ç§ã®åˆ¤æ–­ã«ç¸‹ã‚Šä»˜ã“ã†ã¨ã—ãŸã®ã§ã™\"><span class=\"icon icon-link\"></span></a></h2>\n<p>ãã‚Œã¯å‰å¾Œã§ä¸åº¦ä¸‰ã€å››æ—¥ç¶šã„ã¦å‡ºãŸã€‚å¥¥ã•ã‚“ã®åã¯é™ã¨ã„ã£ãŸã®ã§ã™ã€‚ç§ã¯ãã®æ™‚è‡ªåˆ†ã®è¨€è‘‰ä½¿ã„ã®è§’å¼µã£ãŸã¨ã“ã‚ã«æ°—ãŒä»˜ãã¯ãšãŒãªã‹ã£ãŸã€‚</p>\n<ul>\n<li>å²©ã®ä¸Šã‹ã‚‰è¦‹ä¸‹ã™æ°´ã¯ã€ã¾ãŸæ¥µã‚ã¦ç°¡å˜ã§ã—ãŸã€‚</li>\n<li>ã—ã‹ã‚‚ç´°å›ã¯å¤«ãŒå¯ã¦ã„ã‚‹çˆ¶ã‚’è¦‹ãŸã€‚</li>\n<li>ãã‚ŒãŒè§£ã‚‹ãã‚‰ã„ãªã‚‰ç§ã ã£ã¦åŒã˜äº‹ã§ã‚ã£ãŸã€‚</li>\n</ul>\n<h2 id=\"ã—ã‹ã—ç§ã¯ã“ã®è³ªå•ã®è£ã«ãã£ã¨ç½®ã‹ã‚ŒãŸ\">ã—ã‹ã—â€¦â€¦ç§ã¯ã“ã®è³ªå•ã®è£ã«ãã£ã¨ç½®ã‹ã‚ŒãŸã€‚<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ã—ã‹ã—ç§ã¯ã“ã®è³ªå•ã®è£ã«ãã£ã¨ç½®ã‹ã‚ŒãŸ\"><span class=\"icon icon-link\"></span></a></h2>\n<p>ã‚‚ã†ä½•ã«ã‚‚ã™ã‚‹äº‹ã¯ã‚ã‚Šã¾ã—ãŸã€‚ç§ã¯ã“ã®é–“ä¸­èã„ãŸã®ã§ã™ã€‚ãã®ãã‚‰ã„ã ã‹ã‚‰çˆ¶ã®å±é™ºãŒçœ¼ã®å‰ã«æ¶™ãã‚“ã ã€‚</p>\n<ol>\n<li>äººé–“ã‚’æ„›ã—å¾—ã‚‹äººã€æ„›ã›ãšã«ã¯ã„ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚</li>\n<li>ç§ã¯ä½•ã¨ã‚‚æ€ã„ã¾ã›ã‚“ã§ã—ãŸã€‚</li>\n<li>ã™ã‚‹ã¨ï¼«ã¯è¶³ãŒå‘ã‹ãªããªã‚Šã¾ã™ã€‚</li>\n</ol>"
  },
  "_id": "idea/example.md",
  "_raw": {
    "sourceFilePath": "idea/example.md",
    "sourceFileName": "example.md",
    "sourceFileDir": "idea",
    "contentType": "markdown",
    "flattenedPath": "idea/example"
  },
  "type": "Post",
}
```

ã“ã‚Œã« ToC ã‚’ã¤ã‘ãŸã„ã¨ã„ã†ã®ãŒä»Šå›ã®è¨˜äº‹ã®ä¸»æ—¨ã§ã™ã€‚

```json
{
    "toc": "<div class=\"toc\"><div class=\"h2\">ã‚‚ã£ã¨ã‚‚ãã®æ™‚ã®ç§ã®åˆ¤æ–­ã«ç¸‹ã‚Šä»˜ã“ã†ã¨ã—ãŸã®ã§ã™ã€‚<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ã‚‚ã£ã¨ã‚‚ãã®æ™‚ã®ç§ã®åˆ¤æ–­ã«ç¸‹ã‚Šä»˜ã“ã†ã¨ã—ãŸã®ã§ã™\"><span class=\"icon icon-link\"></span></a></div><div class=\"h2\">ã—ã‹ã—â€¦â€¦ç§ã¯ã“ã®è³ªå•ã®è£ã«ãã£ã¨ç½®ã‹ã‚ŒãŸã€‚<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ã—ã‹ã—ç§ã¯ã“ã®è³ªå•ã®è£ã«ãã£ã¨ç½®ã‹ã‚ŒãŸ\"><span class=\"icon icon-link\"></span></a></div></div>",
}
```

ã“ã†ã„ã†ã“ã¨

```html
<div class="toc">
  <div class="h2">ã‚‚ã£ã¨ã‚‚ãã®æ™‚ã®ç§ã®åˆ¤æ–­ã«ç¸‹ã‚Šä»˜ã“ã†ã¨ã—ãŸã®ã§ã™ã€‚
    <a aria-hidden="true" tabindex="-1"
      href="#ã‚‚ã£ã¨ã‚‚ãã®æ™‚ã®ç§ã®åˆ¤æ–­ã«ç¸‹ã‚Šä»˜ã“ã†ã¨ã—ãŸã®ã§ã™"
      >
      <span class="icon icon-link"></span>
    </a>
  </div>
  <div class="h2">ã—ã‹ã—â€¦â€¦ç§ã¯ã“ã®è³ªå•ã®è£ã«ãã£ã¨ç½®ã‹ã‚ŒãŸã€‚
    <a aria-hidden="true" tabindex="-1"
      href="#ã—ã‹ã—ç§ã¯ã“ã®è³ªå•ã®è£ã«ãã£ã¨ç½®ã‹ã‚ŒãŸ">
      <span class="icon icon-link"></span>
    </a>
  </div>
</div>
```

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ä½•ã¨ã‹ã™ã‚‹

- Contentlayer ã¯ Markdown ã‹ã‚‰ AST ã¸ã®å¤‰æ›ã§[remark]ã‚’ã€AST ã‹ã‚‰ html ã¸ã®å¤‰æ›ã§[rehype]ã‚’ä½¿ã£ã¦ãŠã‚Šã€ãã‚Œãã‚Œã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```typescript
export default makeSource({
  contentDirPath: 'posts',
  documentTypes: [Post],
  markdown: {
    remarkPlugins: [/*ã“ã“ã«remarkãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆºã™*/],
    rehypePlugins: [/*ã“ã“ã«rehypeãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆºã™*/],
  },
});
```

### `remark-toc` ã‚’ä½¿ã†

- [remark-toc](https://github.com/remarkjs/remark-toc)ã¯ã€ç›®æ¬¡ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã® **remark** ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚
  - remark ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã„ã†ã“ã¨ã¯ã€Markdown ã‹ã‚‰ AST ã¸ã®å¤‰æ›æ™‚ã«ä½œç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã­ã€‚
- ã“ã‚Œã ã‘ã ã¨`a`ã‚¿ã‚°ãŒæ©Ÿèƒ½ã—ãªã„ã®ã§ã€[rehype-slug](https://github.com/rehypejs/rehype-slug)ã‚‚å…¥ã‚Œã¦ãŠãã¾ã™ã€‚
  - rehype-slug ã¯ã€å„`h[1-6]`ã‚¿ã‚°ã«`id`ã‚’å‰²ã‚Šå½“ã¦ã¦ãã‚Œã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚

```bash
npm install remark-toc rehype-slug
```

- ã“ã®ã‚ˆã†ã«åˆºã™ã¨ã€`# ç›®æ¬¡`ã®ä¸‹ã« ToC ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```typescript
import remarkToc from 'remark-toc';
import rehypeSlug from 'rehype-slug';

export default makeSource({
  contentDirPath: 'posts',
  documentTypes: [Post],
  markdown: {
    remarkPlugins: [[ remarkToc, { heading: 'ç›®æ¬¡' } ]],
    rehypePlugins: [ rehypeSlug ] },
});
```

- ã“ã‚ŒãŒ

```markdown
## ç›®æ¬¡

## Content1

## Content2
```

- remark ã®å‡¦ç†ä¸­ã«ã“ã†ãªã‚Š

```markdown
## ç›®æ¬¡

- [Content1](#content1)
- [Content2](#content2)

## Content1

## Content2
```

- æœ€çµ‚çš„ã«ã“ã†ãªã‚Šã¾ã™

```html
<h2>ç›®æ¬¡</h2>
<ul>
  <li><a href="#content1">Content1</a></li>
  <li><a href="#content2">Content2</a></li>
</ul>
<h2 id="content1">Content1</h2>
<h2 id="content2">Content2</h2>
```

#### è‰¯ã—æ‚ªã—

- ç›®æ¬¡ã®ä½ç½®ã‚’ Markdown ã®è¨˜è¼‰ã§åˆ¶å¾¡ã§ãã‚‹ã®ã¯ã€ã‚ˆã„ã€‚
- Markdown å´ã«`heading`ã§æŒ‡å®šã—ãŸæ–‡å­—åˆ—ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ›¸ã„ã¦ãŠã‹ãªã„ã¨ã„ã‘ãªã„ã®ã¯ã€ã‚ˆãã¯ãªã„ã€‚
  - ç›®æ¬¡ã‚’ã¤ã‘ãŸã‚Šã¤ã‘ãªã‹ã£ãŸã‚Šã—ãŸã„å ´åˆã«ã¯ã€ã‚ˆã„ã€‚
- æœ¬æ–‡ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ãŒå½“ãŸã‚‹ã®ã¯ã€ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„ã€‚

ç·ã˜ã¦ã€ToC ã‚’æœ¬æ–‡ã«ç´›ã‚Œè¾¼ã¾ã›ã‚‹ç”¨é€”ã«ã¯ã‚ˆã„ã§ã™ãŒã€å€‹äººçš„ã«ã¯ ToC ã‚’ã‚µã‚¤ãƒ‰ãƒãƒ¼çš„ã«è¡¨ç¤ºã—ãŸã„ã®ã§ã€ã¡ã‚‡ã£ã¨ç”¨é€”ã«ã¯åˆã‚ãªã„ã‹ãªã¨ã€‚

### `rehype-toc` ã‚’ä½¿ã†

- [rehype-toc](https://github.com/JS-DevTools/rehype-toc)ã¯ã€ç›®æ¬¡ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã® **rehype** ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚
  - rehype ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã„ã†ã“ã¨ã¯ã€AST ã‹ã‚‰ html (æ­£ç¢ºã«ã¯ã€mdast ã‹ã‚‰ hast)ã¸ã®å¤‰æ›æ™‚ã«ä½œç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
- ã“ã‚Œã‚‚[rehype-slug](https://github.com/rehypejs/rehype-slug)ã¨ä¸€ç·’ã«ä½¿ã„ã¾ã™ã€‚

```bash
npm install remark-toc rehype-slug
```

- ã“ã®ã‚ˆã†ã«åˆºã™ã¨ã€`nav`ã‚¿ã‚°ã§ ToC ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```typescript
import rehypeToc from 'rehype-toc';
import rehypeSlug from 'rehype-slug';

export default makeSource({
  contentDirPath: 'posts',
  documentTypes: [Post],
  markdown: {
    rehypePlugins: [
      rehypeSlug,
      [rehypeToc, { headings: 'h2'} ]
    ]
  },
});
```

- ã“ã‚ŒãŒ

```markdown
## ç›®æ¬¡

## Content1

## Content2
```

- ã“ã†ãªã‚Šã¾ã™

```html
<nav class="toc">
  <ol class="toc-level toc-level-1">
    <li class="toc-item toc-item-h2">
      <a class="toc-link toc-link-h2" href="#ç›®æ¬¡">ç›®æ¬¡</a>
    </li>
    <li class="toc-item toc-item-h2">
      <a class="toc-link toc-link-h2" href="#content1">Content1</a>
    </li>
    <li class="toc-item toc-item-h2">
      <a class="toc-link toc-link-h2" href="#content2">Content2</a>
    </li>
  </ol>
</nav>
<h2 id="ç›®æ¬¡">ç›®æ¬¡</h2>
<h2 id="content1">Content1</h2>
<h2 id="content2">Content2</h2>
```

#### è‰¯ã—æ‚ªã—

- `nav`ã‚¿ã‚°ã«`class`ä»˜ããªã®ã§ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å½“ã¦ã‚„ã™ã„ã®ã¯ã€ã‚ˆã„
- æœ¬æ–‡å´ã«ã¯ã‚¿ã‚°ãŒãªã„ãŸã‚ã€ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ã™ã‚‹å ´åˆã¯ã€ã‚ˆãã¯ãªã„ã€‚
- ã‹ãªã‚‰ãšæœ¬æ–‡ã®å‰ã«æŒ¿å…¥ã•ã‚Œã‚‹ã®ã¯ã€ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„ã€‚

ãŠãŠã‚€ã­ã“ã‚Œã§ã„ã„ã¨æ€ã†ã®ã§ã™ãŒã€ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ã—ãŸã‹ã£ãŸã—ã€æœ¬æ–‡ã¨ã¯åˆ‡ã‚Šé›¢ã—ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸã‹ã£ãŸã®ã§ã€å®Œå…¨ã«ç”¨é€”ã«ãƒãƒƒãƒã—ãŸã¨ã¯è¨€ã„é›£ã„ã€‚

### `computedFields`ã§ä½•ã¨ã‹ã™ã‚‹

- Contentlayer ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å‹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ãã®ä¸­ã« Markdown æœ¬ä½“ã‹ã‚‰å–å¾—ã™ã‚‹ã‚‚ã®ã¨ã¯åˆ¥ã«ã€è¨ˆç®—åˆ—(?)ã‚’è¨­ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- ã¤ã¾ã‚Šã“ã®ã‚ˆã†ã«ã—ã¦ html ã‹ã‚‰ã¶ã£ã“æŠœãã“ã¨ãŒã§ãã‚Œã°ã€`toc`ã«æ ¼ç´ã—ã¦æœ¬æ–‡ã¨ã¯å®Œå…¨ã«ç‹¬ç«‹ã—ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ãã¾ã™ã€‚

```typescript
export const Post = defineDocumentType(() => ({
  name: 'Post',
  filePathPattern: `**/!(*_draft).md`,
  fields: {
    title: { type: 'string', required: true },
    description: { type: 'string' },
    date: { type: 'date', required: true },
    emoji: { type: 'string', required: true },
    tags: { type: 'list', of: { type: 'string' } },
  },
  // ã“ã‚Œ
  computedFields: {
    toc: {
      type: 'string',
      resolve: (post) => generateTableOfContent(post.body.html),
    },
  },
}));
```

- ã“ã‚“ãªæ„Ÿã˜ã§ã€æ­£è¦è¡¨ç¾ã§å¼·å¼•ã«æŠœãã¾ã™ã€‚

```typescript
const generateTableOfContent = (html: string) => {
  //extract heading
  const headings = html.matchAll(/<(h[1-6])\sid=\"(.*?)\">(.*?)<\/h/g);
  const table = [...headings].map(
    (heading) => `<div class="${heading[1]}">${heading[3]}</div>`
  );
  return `<div class="toc">${table.join('')}</div>`;
};
```

- ã™ã‚‹ã¨ã€ã“ã®ã‚ˆã†ã«ç›®æ¬¡ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```html
<div class="toc">
  <div class="h2">ç›®æ¬¡</div>
  <div class="h2">Content1</div>
  <div class="h2">Content2</div>
</div>
```

#### è‰¯ã—æ‚ªã—

- æœ¬æ–‡ã® html ã¨ã¯å®Œå…¨ã«ç‹¬ç«‹ã—ã¦å–å¾—ã§ãã‚‹ã®ã¯ã€ã‚ˆã„ã€‚
  - ã‚¹ã‚¿ã‚¤ãƒ«ã‚‚ã©ã†ã«ã§ã‚‚ã‚ã¦ã‚‰ã‚Œã‚‹ã®ã§ã€ã‚ˆã„ã€‚
- `<h[1-6]>`ã‚¿ã‚°ã®ä¸­èº«ãŒãã®ã¾ã¾æŠœã‘ã‚‹ã®ã¯ã€ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„ã€‚
  - ä¾‹ãˆã°ã€`## [Next.js](https://nextjs.org/)ã‚’ä½¿ã†`ã®ã‚ˆã†ãªè¦‹å‡ºã—ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã®ã§ã€å¤–éƒ¨ãƒªãƒ³ã‚¯ç­‰ã™ã‚‹ã¨ç›®æ¬¡ã‹ã‚‰ã‚‚é£›ã‚“ã§ã—ã¾ã†ã€‚

```html
<div class="h2"><a href="https://nextjs.org/">Next.js</a>ã‚’ä½¿ã†</div>
```

- å€‹äººçš„ã«ã¯ã€ãƒªãƒ³ã‚¯ã”ã¨æŠœã‘ã‚‹ã“ã¨ã®æ‡¸å¿µã‚ˆã‚Šã‚‚ã€ç‹¬ç«‹ã—ã¦å–å¾—ã§ãã‚‹ã»ã†ãŒã‚ã‚ŠãŒãŸã„ã®ã§ã€ã“ã‚Œã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### `rehype-autolink-headings`ã§ãƒªãƒ³ã‚¯ã‚’ã¤ã‘ã‚‹

- ã“ã®ã¾ã¾ã§ã¯ç›®æ¬¡ã‹ã‚‰æœ¬æ–‡ã«é£›ã¹ãªã„ã®ã§ã€ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè‡ªå‹•ã§ãƒªãƒ³ã‚¯ã«ãªã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
- [rehype-autolink-headings](https://github.com/rehypejs/rehype-autolink-headings)ã¯ã€è¦‹å‡ºã—ã«è‡ªå‹•ã§ã‚¢ãƒ³ã‚«ãƒ¼ã‚’ã¤ã‘ã¦ãã‚Œã¾ã™ã€‚

```bash
npm install rehype-autolink-headings
```

```typescript
import rehypeAutolinkHeadings from 'rehype-autolink-headings';
import rehypeSlug from 'rehype-slug';

export default makeSource({
  contentDirPath: 'posts',
  documentTypes: [Post],
  markdown: {
    rehypePlugins: [
      rehypeSlug,
      [rehypeAutolinkHeadings, { behavior: 'append' }],
    ]
  },
});
```

- ã™ã‚‹ã¨ã€æœ¬æ–‡ã¯ã“ã†ãªã‚Šã¾ã™ã€‚
  - `behavior`ã«`append`ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§ã€æ–‡å­—ã®å¾Œã‚ã«`a`ã‚¿ã‚°ãŒãã¾ã™ã€‚
    - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯`preppend`ã§ã€æ–‡å­—ã®å‰ã«`a`ã‚¿ã‚°ãŒæ¥ã¾ã™ã€‚
    - `wrap`ã«ã™ã‚‹ã¨ã€æ–‡å­—åˆ—å…¨ä½“ãŒãƒªãƒ³ã‚¯ã«ãªã‚Šã¾ã™ã€‚
    - `after`ã€`before`ã«ã™ã‚‹ã¨ã€`h`ã‚¿ã‚°ã®å¤–ã«ã€`a`ã‚¿ã‚°ãŒé…ç½®ã•ã‚Œã¾ã™ã€‚

```html
<h2 id="ç›®æ¬¡">ç›®æ¬¡
  <a aria-hidden="true" tabindex="-1" href="#ç›®æ¬¡">
    <span class="icon icon-link"></span>
  </a>
</h2>
<h2 id="content1">Content1
  <a aria-hidden="true" tabindex="-1" href="#content1">
    <span class="icon icon-link"></span>
  </a>
</h2>
<h2 id="content2">Content2
  <a aria-hidden="true" tabindex="-1" href="#content2">
  <span class="icon icon-link"></span>
  </a>
</h2>
```

- ã¨ã„ã†ã“ã¨ã¯ã€`toc`ã‚‚å¼•ããšã‚‰ã‚Œã¦ã“ã†ãªã‚Šã¾ã™ã€‚

```html
<div class="toc">
   <div class="h2">ç›®æ¬¡
    <a aria-hidden="true" tabindex="-1" href="#ç›®æ¬¡">
      <span class="icon icon-link"></span>
    </a>
   </div>
   <div class="h2">Content1
    <a aria-hidden="true" tabindex="-1" href="#content1">
      <span class="icon icon-link"></span>
    </a>
   </div>
   <div class="h2">Content2
    <a aria-hidden="true" tabindex="-1" href="#content2">
      <span class="icon icon-link"></span>
    </a>
   </div>
</div>
```

- `span`ã‚¿ã‚°ãŒç©ºãªã®ã§ã€åˆ¥é€”ã‚¹ã‚¿ã‚¤ãƒ«ã§å·®ã—è¾¼ã¿ã¾ã™ã€‚

```tailwindcss
  .icon {
    @apply inline-block before:content-['ğŸ”—'];
  }
```

- ã‚‚ã—ãã¯ã€`content`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å·®ã—è¾¼ã‚€å†…å®¹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
  - ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã¨ã€`a`ã‚¿ã‚°ã®å­è¦ç´ ã¯`<span>ğŸ”—</span>`ã«ãªã‚Šã¾ã™ã€‚

```typescript
  [
    rehypeAutolinkHeadings,
    {
      behavior: 'append',
      content: {
        type: 'element',
        tagName: 'span',
        properties: {},
        children: [{ type: 'text', value: 'ğŸ”—' }],
      },
    },
  ],
```

## ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°ã‚’è¿½åŠ ã™ã‚‹

- Markdown ã§ã¯è¡¨ç¾ã—ãã‚Œãªã„å ´åˆã€html ã‚’æ›¸ãã“ã¨ã«ãªã‚Šã¾ã™ãŒã€Qiita ã§ã„ã†ã¨ã“ã‚ã®

:::note info
ã“ã‚Œã¨ã‹
:::

:::note alert
ã“ã‚Œ
:::

ãŒç°¡å˜ã«ä½¿ãˆã‚‹ã¨ã€ãƒ–ãƒ­ã‚°ã¨ã—ã¦ã®è¡¨ç¾åŠ›ãŒã‚°ãƒƒã¨å¢—ã—ã¾ã™ã‚ˆã­ã€‚

### `remark-directive`ã¨`remark-directive-rehype`ã§ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°ã‚’ä½¿ã†

- [remark-directive](https://github.com/remarkjs/remark-directive)ã¯ã‚³ãƒ­ãƒ³(`:`)ã‚’ä½¿ã£ãŸã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’è§£é‡ˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ remark ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚
- [remark-directive-rehype](https://github.com/IGassmann/remark-directive-rehype)ã¯ remark-directive ãŒè§£é‡ˆã—ãŸã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’[remark-rehype](https://github.com/remarkjs/remark-rehype)ã«æ©‹æ¸¡ã—ã—ã¦ãã‚Œã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚
  - `remark-rehype`ã¯ Contentlayer ãŒä¸­ã§ä½¿ã£ã¦ã„ã¾ã™ã€‚

```bash
npm install remark-directive remark-directive-rehype
```

```typescript
import remarkDirective from 'remark-directive'; // è¿½åŠ 
import remarkDirectiveRehype from 'remark-directive-rehype'; // è¿½åŠ 
import rehypeAutolinkHeadings from 'rehype-autolink-headings';
import rehypeSlug from 'rehype-slug';

export default makeSource({
  contentDirPath: 'posts',
  documentTypes: [Post],
  markdown: {
    remarkPlugins: [
      remarkDirective, // è¿½åŠ 
      remarkDirectiveRehype, // è¿½åŠ 
    ],
    rehypePlugins: [
      rehypeSlug,
      [rehypeAutolinkHeadings, { behavior: 'append' }],
    ]
  },
});
```

- ã“ã‚ŒãŒ

```markdown
## Content1

:tag-warning[æ³¨æ„ã‚¿ã‚°]

## Content2

:note-error[ã‚¨ãƒ©ãƒ¼ãƒãƒ¼ãƒˆ]
```

- ã“ã†ãªã‚Šã¾ã™

```html
<h2 id="content1">Content1
  <a aria-hidden="true" tabindex="-1" href="#content1">
    <span class="icon icon-link"></span>
  </a>
</h2>
<p><tag-warning>æ³¨æ„ã‚¿ã‚°</tag-warning></p>
<h2 id="content2">Content2
    <a aria-hidden="true" tabindex="-1" href="#content2">
    <span class="icon icon-link"></span>
  </a>
</h2>
<note-error>
	<p>error / ã‚¨ãƒ©ãƒ¼</p>
</note-error>
```

- ã“ã‚Œã‚‰ã¯ html ã‚¿ã‚°ã§ã¯ãªã„ã®ã§ã™ãŒã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒã„ã„æ„Ÿã˜ã«è§£é‡ˆã—ã¦è¡¨ç¤ºã—ã¦ãã‚Œã¾ã™ã€‚
  - ç”˜ãˆãŸããªã„å ´åˆã¯ã€ã‚«ã‚¹ã‚¿ãƒ è¦ç´ ã‚’å®šç¾©ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```javascript
class TagWaning extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
    const wrapper = document.createElement('span');
    wrapper.innerHTML = '<slot></slot>';
    wrapper.setAttribute('class', 'tag-warning');
    this.shadowRoot.append(wrapper);
  }
}
customElements.define('tag-warning', TagWaning);
```

```javascript
class NoteError extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
    const wrapper = document.createElement('div');
    wrapper.innerHTML = '<slot></slot>';
    wrapper.setAttribute('class', 'note-error');
    this.shadowRoot.append(wrapper);
  }
}
customElements.define('note-error', NoteError);
```

## GitHub Flavored Markdown

- æˆ‘ã€…ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã¯ Markdown ã¨ç§°ã—ã¦æ¯ã‚’ã™ã‚‹ã‚ˆã†ã« GFM (**ã®ã‚ˆã†ãªã‚‚ã®**)ã‚’æ›¸ã„ã¦ãŠã‚Šã€`~~`ã§æ‰“ã¡æ¶ˆã—ç·šãŒæ›¸ã‘ãªã„ã¨é ­ãŒãŠã‹ã—ããªã‚Šã¾ã™ã€‚
  - å®‰å¿ƒã—ã¦ãã ã•ã„ã€‚[`remark-gfm`](https://github.com/remarkjs/remark-gfm)ãŒã‚ã‚Šã¾ã™ã€‚

```bash
npm install remark-gfm
```

```typescript
import remarkGfm from 'remark-gfm'; // è¿½åŠ 
import remarkDirective from 'remark-directive';
import remarkDirectiveRehype from 'remark-directive-rehype';
import rehypeAutolinkHeadings from 'rehype-autolink-headings';
import rehypeSlug from 'rehype-slug';

export default makeSource({
  contentDirPath: 'posts',
  documentTypes: [Post],
  markdown: {
    remarkPlugins: [
      remarkDirective,
      remarkDirectiveRehype,
      remarkGfm, // è¿½åŠ 
    ],
    rehypePlugins: [
      rehypeSlug,
      [rehypeAutolinkHeadings, { behavior: 'append' }],
    ]
  },
});
```

- ã‚ã‚“ã©ãã•ããªã£ã¦ããŸã®ã§ä¾‹ã¯å‰²æ„›ã—ã¾ã™ãŒã€ã“ã‚Œã§`~~`ãŒæ‰“ã¡æ¶ˆã—ç·šã«ãªã‚Šã€è¡¨ã‚‚æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯

- ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãƒ–ãƒ­ã‚°ã§ã‚ã‚‹ãªã‚‰ã°ã€ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ãã‚Œã„ã«è¡¨ç¤ºã—ãŸã„ã§ã™ã‚ˆã­ã€‚
  - [`rehype-pretty-code`](https://github.com/atomiks/rehype-pretty-code)ã§ãã‚Œã„ã«ã—ã¾ã—ã‚‡ã†ã€‚
  - rehype-pretty-code ã¯[Shiki](https://github.com/shikijs/shiki)ã‚’ä½¿ã£ã¦ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’è£…é£¾ã—ã¦ãã‚Œã¾ã™ã€‚

```bash
npm install rehype-pretty-code shiki
```

```typescript
import remarkGfm from 'remark-gfm';
import remarkDirective from 'remark-directive';
import remarkDirectiveRehype from 'remark-directive-rehype';
import rehypeAutolinkHeadings from 'rehype-autolink-headings';
import rehypeSlug from 'rehype-slug';
import rehypePrettyCode from 'rehype-pretty-code'; // è¿½åŠ 

export default makeSource({
  contentDirPath: 'posts',
  documentTypes: [Post],
  markdown: {
    remarkPlugins: [
      remarkDirective,
      remarkDirectiveRehype,
      remarkGfm,
    ],
    rehypePlugins: [
      rehypeSlug,
      [rehypeAutolinkHeadings, { behavior: 'append' }],
      [rehypePrettyCode, { theme: 'rose-pine-moon' }],// è¿½åŠ 
    ]
  },
});
```

- ã“ã‚Œã§ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã«ã‚¹ã‚¿ã‚¤ãƒ«ãŒå½“ãŸã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
  - ãƒ†ãƒ¼ãƒã¯ Shiki ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã‚‰é¸ã¹ã¾ã™ã€‚[å‚è€ƒ](https://unpkg.com/browse/shiki@0.14.2/themes/)

## çµ‚ã‚ã‚Šã«

- ãšã„ã¶ã‚“é•·ã„è¨˜äº‹ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚
  - Contentlayer ã¯è‡ªç”±åº¦ãŒé«˜ãã¦æ‰±ã„ã‚„ã™ã„ã®ã§ã€Next.js + Markdown ã§ãƒ–ãƒ­ã‚°ã‚’ä½œã‚‹ãªã‚‰ãŠã™ã™ã‚ã§ã™ã€‚
